<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - DA Transporter</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
        .container { max-width: 1200px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px #ccc; }
        h1 { margin-bottom: 30px; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat { background: #fafafa; padding: 20px; border-radius: 6px; text-align: center; box-shadow: 0 1px 4px #eee; }
        .stat-title { font-size: 14px; color: #555; margin-bottom: 8px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #222; }
        .section { margin-bottom: 40px; }
        .section-title { font-size: 20px; margin-bottom: 16px; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background: #f0f0f0; }
        .activity-list, .review-list { list-style: none; padding: 0; }
        .activity-item, .review-item { background: #fafafa; margin-bottom: 10px; padding: 12px; border-radius: 5px; box-shadow: 0 1px 2px #eee; }
        .driver-rating { color: #4CAF50; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <a href="Backend/admin_logout.php" class="admin-link" style="float:right; margin-top:-10px; margin-right:-10px;">Logout</a>
        <h1>Admin Dashboard</h1>
        <div class="stats" id="stats">
            <!-- Stats -->
        </div>

        <div class="section">
            <div class="section-title">Recent Activities (Last 24 Hours)</div>
            <ul class="activity-list" id="activityList"></ul>
        </div>

        <div class="section">
            <div class="section-title">Top Drivers</div>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Trips</th>
                        <th>Avg. Rating</th>
                    </tr>
                </thead>
                <tbody id="topDriversBody"></tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-title">Recent Reviews</div>
            <ul class="review-list" id="reviewList"></ul>
        </div>
    </div>

    <script>
        fetch('Backend/admin_dashboard_data.php')
            .then(res => res.json())
            .then(data => {
                if (!data.success) {
                    document.body.innerHTML = '<h2>Failed to load dashboard: ' + data.message + '</h2>';
                    return;
                }
                // Stats
                const stats = data.data.stats;
                document.getElementById('stats').innerHTML = `
                    <div class="stat"><div class="stat-title">Total Users</div><div class="stat-value">${stats.total_users}</div></div>
                    <div class="stat"><div class="stat-title">Total Drivers</div><div class="stat-value">${stats.total_drivers}</div></div>
                    <div class="stat"><div class="stat-title">Total Students</div><div class="stat-value">${stats.total_students}</div></div>
                    <div class="stat"><div class="stat-title">Total Trips</div><div class="stat-value">${stats.total_trips}</div></div>
                    <div class="stat"><div class="stat-title">Active Trips</div><div class="stat-value">${stats.active_trips}</div></div>
                    <div class="stat"><div class="stat-title">Completed Trips</div><div class="stat-value">${stats.completed_trips}</div></div>
                    <div class="stat"><div class="stat-title">Total Vehicles</div><div class="stat-value">${stats.total_vehicles}</div></div>
                    <div class="stat"><div class="stat-title">Total Earnings</div><div class="stat-value">à§³${stats.total_earnings}</div></div>
                    <div class="stat"><div class="stat-title">Recent Registrations (7d)</div><div class="stat-value">${stats.recent_users}</div></div>
                `;

                // Activities
                const activities = data.data.activities;
                const activityList = document.getElementById('activityList');
                activityList.innerHTML = activities.length === 0 ? '<li>No recent activities.</li>' :
                    activities.map(a => `<li class="activity-item"><strong>${a.message}</strong><br><small>${a.time}</small></li>`).join('');

                // Top Drivers
                const topDrivers = data.data.top_drivers;
                const topDriversBody = document.getElementById('topDriversBody');
                topDriversBody.innerHTML = topDrivers.length === 0 ? '<tr><td colspan="4">No data</td></tr>' :
                    topDrivers.map(d => `
                        <tr>
                            <td>${d.Name}</td>
                            <td>${d.Phone}</td>
                            <td>${d.trip_count}</td>
                            <td class="driver-rating">${parseFloat(d.avg_rating).toFixed(2)}</td>
                        </tr>
                    `).join('');

                // Recent Reviews
                const reviews = data.data.recent_reviews;
                const reviewList = document.getElementById('reviewList');
                reviewList.innerHTML = reviews.length === 0 ? '<li>No recent reviews.</li>' :
                    reviews.map(r => `
                        <li class="review-item">
                            <strong>${r.rater_name}</strong> rated <strong>${r.driver_name}</strong>: 
                            <span class="driver-rating">${r.Rating}/5</span><br>
                            <em>${r.Comment}</em><br>
                            <small>${r.Created}</small>
                        </li>
                    `).join('');
            });
    </script>
</body>
</html>